<!DOCTYPE html>
<html>
<head>
  <title>ë””ì•„ë¸”ë¡œ4 ë³´ìŠ¤ & êµ°ë‹¨ íƒ€ì´ë¨¸</title>
  <meta charset="UTF-8">
  <style>
      body {
          display: flex;
          justify-content: center;
          align-items: center;
          min-height: 100vh;
          background-color: #f0f0f0;
          font-family: sans-serif;
          gap: 40px;
          flex-wrap: wrap;
          padding: 20px;
      }

      .timer-wrapper {
          display: flex;
          flex-direction: column;
          align-items: center;
      }

      .timer-title {
          font-size: 1.3em;
          font-weight: bold;
          margin-bottom: 10px;
          text-align: center;
          color: #333;
      }

      .timer-container {
          position: relative;
          width: 300px;
          height: 300px;
          display: flex;
          flex-direction: column;
          justify-content: center;
          align-items: center;
      }

      .timer-canvas {
          display: block;
          position: absolute;
          top: 0;
          left: 0;
      }

      .timer-text {
          position: relative;
          z-index: 1;
          font-size: 2.2em;
          font-weight: bold;
          color: #d0d0d0;
          margin-bottom: 10px;
          text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
      }

      .message-text {
          position: relative;
          z-index: 1;
          font-size: 1.1em;
          font-weight: bold;
          color: red;
          text-align: center;
          height: 2em;
          line-height: 1.2em;
          max-width: 250px;
      }

      /* ë°˜ì‘í˜• ë””ìì¸ */
      @media (max-width: 700px) {
          body {
              flex-direction: column;
              gap: 30px;
          }

          .timer-container {
              width: 250px;
              height: 250px;
          }

          .timer-text {
              font-size: 1.8em;
          }
      }
  </style>
</head>
<body>

<!-- ì›”ë“œ ë³´ìŠ¤ íƒ€ì´ë¨¸ -->
<div class="timer-wrapper">
  <div class="timer-title">ğŸ² ì›”ë“œ ë³´ìŠ¤ (3ì‹œê°„ 30ë¶„)</div>
  <div class="timer-container">
    <canvas class="timer-canvas" id="boss-canvas" width="300" height="300"></canvas>
    <div class="timer-text" id="boss-timer-text">--:--:--</div>
    <div class="message-text" id="boss-message-text"></div>
  </div>
</div>

<!-- êµ°ë‹¨ ì´ë²¤íŠ¸ íƒ€ì´ë¨¸ -->
<div class="timer-wrapper">
  <div class="timer-title">âš”ï¸ êµ°ë‹¨ ì´ë²¤íŠ¸ (25ë¶„)</div>
  <div class="timer-container">
    <canvas class="timer-canvas" id="legion-canvas" width="300" height="300"></canvas>
    <div class="timer-text" id="legion-timer-text">--:--</div>
    <div class="message-text" id="legion-message-text"></div>
  </div>
</div>

<script>
  // --- DOM ìš”ì†Œ ê°€ì ¸ì˜¤ê¸° ---
  // ì›”ë“œ ë³´ìŠ¤ íƒ€ì´ë¨¸ ìš”ì†Œë“¤
  const bossCanvas = document.getElementById('boss-canvas');
  const bossCtx = bossCanvas.getContext('2d');
  const bossTimerTextElement = document.getElementById('boss-timer-text');
  const bossMessageTextElement = document.getElementById('boss-message-text');

  // êµ°ë‹¨ ì´ë²¤íŠ¸ íƒ€ì´ë¨¸ ìš”ì†Œë“¤
  const legionCanvas = document.getElementById('legion-canvas');
  const legionCtx = legionCanvas.getContext('2d');
  const legionTimerTextElement = document.getElementById('legion-timer-text');
  const legionMessageTextElement = document.getElementById('legion-message-text');

  // --- ìƒìˆ˜ ì„¤ì • ---
  const DEFAULT_LINE_WIDTH = 10;
  const bossRadius = bossCanvas.width / 2 - (DEFAULT_LINE_WIDTH * 2 / 2) - 5;
  const legionRadius = legionCanvas.width / 2 - (DEFAULT_LINE_WIDTH * 2 / 2) - 5;

  // ì›”ë“œ ë³´ìŠ¤: 3ì‹œê°„ 30ë¶„
  const BOSS_CYCLE_MINUTES = 3 * 60 + 30;
  const BOSS_CYCLE_MS = BOSS_CYCLE_MINUTES * 60 * 1000;

  // êµ°ë‹¨ ì´ë²¤íŠ¸: 25ë¶„
  const LEGION_CYCLE_MINUTES = 25;
  const LEGION_CYCLE_MS = LEGION_CYCLE_MINUTES * 60 * 1000;

  const COLOR_DEFAULT = '#0092FF';
  const COLOR_WARN = 'orange';
  const COLOR_ALERT = 'red';
  const COLOR_LEGION = '#9d4edd'; // êµ°ë‹¨ ì´ë²¤íŠ¸ ê¸°ë³¸ ìƒ‰ìƒ
  const COLOR_BACKGROUND = '#e0e0e0';

  // --- ìƒíƒœ ë³€ìˆ˜ ---
  let bossCanPlaySound = true;
  let legionCanPlaySound = true;

  // --- ê³µí†µ í•¨ìˆ˜ë“¤ ---
  const playImpactSound = async () => {
    const audio = new Audio(`impact.mp3`);
    audio.oncanplaythrough = async () => {
      let duration = audio.duration;
      await audio.play();
      setTimeout(() => {}, duration * 1000);
    };
    audio.load();
  }

  function getMostRecentMondayMidnight() {
    const now = new Date();
    const currentDay = now.getDay();
    const daysSinceMonday = (currentDay === 0) ? 6 : currentDay - 1;
    const mondayMidnight = new Date(now);
    mondayMidnight.setDate(now.getDate() - daysSinceMonday);
    mondayMidnight.setHours(0, 0, 0, 0);
    return mondayMidnight;
  }

  function formatTime(ms, showHours = true) {
    if (ms < 0) ms = 0;
    const totalSeconds = Math.floor(ms / 1000);
    const hours = Math.floor(totalSeconds / 3600);
    const minutes = Math.floor((totalSeconds % 3600) / 60);
    const seconds = totalSeconds % 60;

    if (showHours) {
      return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
    } else {
      return `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
    }
  }

  // --- ì›”ë“œ ë³´ìŠ¤ íƒ€ì´ë¨¸ ê·¸ë¦¬ê¸° í•¨ìˆ˜ ---
  function drawBossTimer(remainingMs) {
    const centerX = bossCanvas.width / 2;
    const centerY = bossCanvas.height / 2;
    const startAngle = -0.5 * Math.PI;

    const progress = Math.max(0, Math.min(1, remainingMs / BOSS_CYCLE_MS));
    const endAngle = startAngle + progress * 2 * Math.PI;

    let color = COLOR_DEFAULT;
    let currentLineWidth = DEFAULT_LINE_WIDTH;
    let message = "ë””ì•„ë¸”ë¡œ4 ì›”ë“œ ë³´ìŠ¤ ì•Œë¦¼ì´";
    const remainingMinutes = remainingMs / (60 * 1000);

    if (remainingMinutes < 5) {
      color = COLOR_ALERT;
      currentLineWidth = DEFAULT_LINE_WIDTH * 2;
      message = "ë¹¨ë¦¬ ë›°ì–´ ì›”ë“œ ë³´ìŠ¤ ì¡ì•„ì•¼ í•´";
      if (bossCanPlaySound) {
        playImpactSound();
        bossCanPlaySound = false;
      }
    } else if (remainingMinutes < 10) {
      color = COLOR_WARN;
      currentLineWidth = DEFAULT_LINE_WIDTH * 1.5;
      message = "ì›”ë“œ ë³´ìŠ¤ ì¤€ë¹„!";
      bossCanPlaySound = true;
    } else if (remainingMinutes > 10) {
      color = COLOR_DEFAULT;
      currentLineWidth = DEFAULT_LINE_WIDTH;
      message = "ë””ì•„ë¸”ë¡œ4 ì›”ë“œ ë³´ìŠ¤ ì•Œë¦¼ì´";
      bossCanPlaySound = true;
    }

    // ìº”ë²„ìŠ¤ ì§€ìš°ê¸°
    bossCtx.clearRect(0, 0, bossCanvas.width, bossCanvas.height);

    // ë°°ê²½ ì› ê·¸ë¦¬ê¸°
    bossCtx.beginPath();
    bossCtx.arc(centerX, centerY, bossRadius, 0, 2 * Math.PI);
    bossCtx.strokeStyle = COLOR_BACKGROUND;
    bossCtx.lineWidth = DEFAULT_LINE_WIDTH / 2;
    bossCtx.stroke();

    // ì§„í–‰ë¥  í˜¸ ê·¸ë¦¬ê¸°
    if (progress > 0) {
      bossCtx.beginPath();
      bossCtx.arc(centerX, centerY, bossRadius, startAngle, endAngle);
      bossCtx.strokeStyle = color;
      bossCtx.lineWidth = currentLineWidth;
      bossCtx.lineCap = 'round';
      bossCtx.stroke();
    }

    // í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
    bossTimerTextElement.textContent = formatTime(remainingMs, true);
    bossMessageTextElement.textContent = message;
    bossMessageTextElement.style.visibility = message ? 'visible' : 'hidden';
    bossMessageTextElement.style.color = COLOR_ALERT;
  }

  // --- êµ°ë‹¨ ì´ë²¤íŠ¸ íƒ€ì´ë¨¸ ê·¸ë¦¬ê¸° í•¨ìˆ˜ ---
  function drawLegionTimer(remainingMs) {
    const centerX = legionCanvas.width / 2;
    const centerY = legionCanvas.height / 2;
    const startAngle = -0.5 * Math.PI;

    const progress = Math.max(0, Math.min(1, remainingMs / LEGION_CYCLE_MS));
    const endAngle = startAngle + progress * 2 * Math.PI;

    let color = COLOR_LEGION;
    let currentLineWidth = DEFAULT_LINE_WIDTH;
    let message = "êµ°ë‹¨ ì´ë²¤íŠ¸ ëŒ€ê¸° ì¤‘";
    const remainingMinutes = remainingMs / (60 * 1000);

    if (remainingMinutes < 2) {
      color = COLOR_ALERT;
      currentLineWidth = DEFAULT_LINE_WIDTH * 2;
      message = "êµ°ë‹¨ ì´ë²¤íŠ¸ ê³§ ì‹œì‘!";
      if (legionCanPlaySound) {
        playImpactSound();
        legionCanPlaySound = false;
      }
    } else if (remainingMinutes < 5) {
      color = COLOR_WARN;
      currentLineWidth = DEFAULT_LINE_WIDTH * 1.5;
      message = "êµ°ë‹¨ ì´ë²¤íŠ¸ ì¤€ë¹„í•˜ì„¸ìš”";
      legionCanPlaySound = true;
    } else {
      color = COLOR_LEGION;
      currentLineWidth = DEFAULT_LINE_WIDTH;
      message = "êµ°ë‹¨ ì´ë²¤íŠ¸ ëŒ€ê¸° ì¤‘";
      legionCanPlaySound = true;
    }

    // ìº”ë²„ìŠ¤ ì§€ìš°ê¸°
    legionCtx.clearRect(0, 0, legionCanvas.width, legionCanvas.height);

    // ë°°ê²½ ì› ê·¸ë¦¬ê¸°
    legionCtx.beginPath();
    legionCtx.arc(centerX, centerY, legionRadius, 0, 2 * Math.PI);
    legionCtx.strokeStyle = COLOR_BACKGROUND;
    legionCtx.lineWidth = DEFAULT_LINE_WIDTH / 2;
    legionCtx.stroke();

    // ì§„í–‰ë¥  í˜¸ ê·¸ë¦¬ê¸°
    if (progress > 0) {
      legionCtx.beginPath();
      legionCtx.arc(centerX, centerY, legionRadius, startAngle, endAngle);
      legionCtx.strokeStyle = color;
      legionCtx.lineWidth = currentLineWidth;
      legionCtx.lineCap = 'round';
      legionCtx.stroke();
    }

    // í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
    legionTimerTextElement.textContent = formatTime(remainingMs, false);
    legionMessageTextElement.textContent = message;
    legionMessageTextElement.style.visibility = message ? 'visible' : 'hidden';
    legionMessageTextElement.style.color = color === COLOR_ALERT ? COLOR_ALERT : COLOR_LEGION;
  }

  // --- ë©”ì¸ ì—…ë°ì´íŠ¸ ë£¨í”„ ---
  function update() {
    const now = new Date();
    const mondayMidnight = getMostRecentMondayMidnight();
    const elapsedMsSinceMonday = now.getTime() - mondayMidnight.getTime();

    if (elapsedMsSinceMonday < 0) {
      drawBossTimer(BOSS_CYCLE_MS);
      drawLegionTimer(LEGION_CYCLE_MS);
      requestAnimationFrame(update);
      return;
    }

    // ì›”ë“œ ë³´ìŠ¤ íƒ€ì´ë¨¸ ê³„ì‚°
    const bossRemaining = BOSS_CYCLE_MS - (elapsedMsSinceMonday % BOSS_CYCLE_MS);

    // êµ°ë‹¨ ì´ë²¤íŠ¸ íƒ€ì´ë¨¸ ê³„ì‚°
    const legionRemaining = LEGION_CYCLE_MS - (elapsedMsSinceMonday % LEGION_CYCLE_MS);

    // íƒ€ì´ë¨¸ ê·¸ë¦¬ê¸°
    drawBossTimer(bossRemaining);
    drawLegionTimer(legionRemaining);

    requestAnimationFrame(update);
  }

  // ì´ˆê¸° íƒ€ì´ë¨¸ ì‹¤í–‰
  update();
</script>

</body>
</html>
