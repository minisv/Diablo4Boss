<!DOCTYPE html>
<html>
<head>
  <title>ë””ì•„ë¸”ë¡œ4 ë³´ìŠ¤ & êµ°ë‹¨ íƒ€ì´ë¨¸</title>
  <meta charset="UTF-8">
  <style>
      body {
          display: flex;
          flex-direction: column;
          justify-content: center;
          align-items: center;
          min-height: 100vh;
          font-family: sans-serif;
          gap: 20px;
          padding: 20px;
      }

      /* íƒ€ì´ë¨¸ ì»¨í…Œì´ë„ˆ ê³µí†µ ìŠ¤íƒ€ì¼ */
      .timer-container {
          width: 350px;
          height: 100px;
          position: relative;
          overflow: hidden;
          border: 2px solid #333;
          border-radius: 8px;
      }

      /* ì œëª© ìŠ¤íƒ€ì¼ */
      .timer-title {
          text-align: center;
          font-size: 1.2em;
          font-weight: bold;
          margin-bottom: 5px;
          color: #333;
      }

      /* ì§„í–‰ë¥  ë°” ê³µí†µ ìŠ¤íƒ€ì¼ */
      .progress-bar {
          position: absolute;
          left: 0;
          width: 100%;
          border-radius: 5px;
          transition: width 0.2s linear, background-color 0.3s ease, height 0.3s ease, top 0.3s ease;
      }

      /* í…ìŠ¤íŠ¸ ì˜¤ë²„ë ˆì´ ê³µí†µ ìŠ¤íƒ€ì¼ */
      .text-overlay {
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          display: flex;
          flex-direction: column;
          justify-content: center;
          align-items: center;
          z-index: 1;
          pointer-events: none;
          text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);
      }

      /* ì‹œê°„ í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
      .timer-text {
          font-size: 2.0em;
          font-weight: bold;
          color: #fff;
          text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);
      }

      /* ë©”ì‹œì§€ í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
      .message-text {
          font-size: 1.0em;
          font-weight: bold;
          color: #fff;
          text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.8);
          height: 1.5em;
          line-height: 1.5em;
          margin-top: 2px;
      }

      /* ì˜¤ë””ì˜¤ ì¬ìƒ ì‹¤íŒ¨ ì‹œ ì‚¬ìš©ì ì•ˆë‚´ ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ */
      #audio-prompt {
          position: fixed;
          top: 10px;
          left: 50%;
          transform: translateX(-50%);
          background-color: rgba(255, 255, 0, 0.8);
          padding: 10px;
          border: 1px solid black;
          border-radius: 5px;
          z-index: 1000;
          cursor: pointer;
          font-size: 0.9em;
      }
  </style>
</head>
<body>

<!-- ì›”ë“œ ë³´ìŠ¤ íƒ€ì´ë¨¸ -->
<div>
  <div class="timer-title">ğŸ² ì›”ë“œ ë³´ìŠ¤ íƒ€ì´ë¨¸ (3ì‹œê°„ 30ë¶„)</div>
  <div class="timer-container" id="boss-timer-container">
    <div class="progress-bar" id="boss-progress-bar"></div>
    <div class="text-overlay">
      <div class="timer-text" id="boss-timer-text">--:--:--</div>
      <div class="message-text" id="boss-message-text"></div>
    </div>
  </div>
</div>

<!-- êµ°ë‹¨ ì´ë²¤íŠ¸ íƒ€ì´ë¨¸ -->
<div>
  <div class="timer-title">âš”ï¸ êµ°ë‹¨ ì´ë²¤íŠ¸ íƒ€ì´ë¨¸ (25ë¶„)</div>
  <div class="timer-container" id="legion-timer-container">
    <div class="progress-bar" id="legion-progress-bar"></div>
    <div class="text-overlay">
      <div class="timer-text" id="legion-timer-text">--:--</div>
      <div class="message-text" id="legion-message-text"></div>
    </div>
  </div>
</div>

<audio id="alert-sound" src="impact.mp3" preload="auto"></audio>

<div id="audio-prompt" style="display: none;">ì•Œë¦¼ ì†Œë¦¬ë¥¼ ì¬ìƒí•˜ë ¤ë©´ ì—¬ê¸°ë¥¼ í´ë¦­í•˜ì„¸ìš”.</div>

<script>
  // --- DOM ìš”ì†Œ ê°€ì ¸ì˜¤ê¸° ---
  // ì›”ë“œ ë³´ìŠ¤ íƒ€ì´ë¨¸ ìš”ì†Œë“¤
  const bossProgressBarElement = document.getElementById('boss-progress-bar');
  const bossTimerTextElement = document.getElementById('boss-timer-text');
  const bossMessageTextElement = document.getElementById('boss-message-text');

  // êµ°ë‹¨ ì´ë²¤íŠ¸ íƒ€ì´ë¨¸ ìš”ì†Œë“¤
  const legionProgressBarElement = document.getElementById('legion-progress-bar');
  const legionTimerTextElement = document.getElementById('legion-timer-text');
  const legionMessageTextElement = document.getElementById('legion-message-text');

  // ê³µí†µ ìš”ì†Œë“¤
  const alertSound = document.getElementById('alert-sound');
  const audioPromptElement = document.getElementById('audio-prompt');

  // --- ìƒìˆ˜ ì„¤ì • ---
  // ì›”ë“œ ë³´ìŠ¤: 3ì‹œê°„ 30ë¶„
  const BOSS_CYCLE_MINUTES = 3 * 60 + 30;
  const BOSS_CYCLE_MS = BOSS_CYCLE_MINUTES * 60 * 1000;

  // êµ°ë‹¨ ì´ë²¤íŠ¸: 25ë¶„
  const LEGION_CYCLE_MINUTES = 25;
  const LEGION_CYCLE_MS = LEGION_CYCLE_MINUTES * 60 * 1000;

  const COLOR_DEFAULT = '#0092FF';
  const COLOR_WARN = 'orange';
  const COLOR_ALERT = 'red';
  const COLOR_LEGION = '#9d4edd'; // êµ°ë‹¨ ì´ë²¤íŠ¸ ê¸°ë³¸ ìƒ‰ìƒ (ë³´ë¼ìƒ‰)

  // --- ìƒíƒœ ë³€ìˆ˜ ---
  let bossSoundPlayedInThisCycle = false;
  let legionSoundPlayedInThisCycle = false;

  // --- í•¨ìˆ˜ ì •ì˜ ---
  function getMostRecentMondayMidnight() {
    const now = new Date();
    const currentDay = now.getDay();
    const daysSinceMonday = (currentDay === 0) ? 6 : currentDay - 1;
    const mondayMidnight = new Date(now);
    mondayMidnight.setDate(now.getDate() - daysSinceMonday);
    mondayMidnight.setHours(0, 0, 0, 0);
    return mondayMidnight;
  }

  function formatTime(ms, showSeconds = true) {
    if (ms < 0) ms = 0;
    const totalSeconds = Math.floor(ms / 1000);
    const hours = Math.floor(totalSeconds / 3600);
    const minutes = Math.floor((totalSeconds % 3600) / 60);
    const seconds = totalSeconds % 60;

    if (showSeconds) {
      return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
    } else {
      return `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
    }
  }

  function playAlertSound() {
    alertSound.currentTime = 0;
    const playPromise = alertSound.play();
    if (playPromise !== undefined) {
      playPromise.then(_ => {
        audioPromptElement.style.display = 'none';
        console.log("ì•Œë¦¼ìŒ ìë™ ì¬ìƒ ì„±ê³µ");
      }).catch(error => {
        console.error("ì•Œë¦¼ìŒ ìë™ ì¬ìƒ ì‹¤íŒ¨:", error);
        if (audioPromptElement.style.display === 'none') {
          audioPromptElement.style.display = 'block';
          audioPromptElement.onclick = () => {
            alertSound.play();
            audioPromptElement.style.display = 'none';
            audioPromptElement.onclick = null;
          };
        }
      });
    }
  }

  // --- ì›”ë“œ ë³´ìŠ¤ íƒ€ì´ë¨¸ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ ---
  function updateBossDisplay(remainingMs) {
    const progress = Math.max(0, Math.min(1, remainingMs / BOSS_CYCLE_MS));
    const remainingMinutes = remainingMs / (60 * 1000);

    let color = COLOR_DEFAULT;
    let heightFactor = 0.8;
    let message = "ë””ì•„ë¸”ë¡œ4 ì›”ë“œ ë³´ìŠ¤ ì•Œë¦¼ì´";
    let textColor = "#fff";

    if (remainingMinutes < 5) {
      color = COLOR_ALERT;
      heightFactor = 1.0;
      message = "ë¹¨ë¦¬ ë›°ì–´ ì›”ë“œ ë³´ìŠ¤ ì¡ì•„ì•¼ í•´";
      textColor = "#fff";
    } else if (remainingMinutes < 10) {
      color = COLOR_WARN;
      heightFactor = 0.8;
      message = "ì›”ë“œ ë³´ìŠ¤ê°€ ê³§ ë“±ì¥í•©ë‹ˆë‹¤";
      textColor = "#fff";
    } else if (remainingMinutes > 10) {
      color = COLOR_DEFAULT;
      heightFactor = 0.8;
      message = "ë””ì•„ë¸”ë¡œ4 ì›”ë“œ ë³´ìŠ¤ ì•Œë¦¼ì´";
      textColor = "#fff";
    }

    bossProgressBarElement.style.width = `${progress * 100}%`;
    bossProgressBarElement.style.backgroundColor = color;
    bossProgressBarElement.style.height = `${heightFactor * 100}%`;
    bossProgressBarElement.style.top = `${(1 - heightFactor) / 2 * 100}%`;

    bossTimerTextElement.textContent = formatTime(remainingMs, true);
    bossMessageTextElement.textContent = message;
    bossMessageTextElement.style.visibility = message ? 'visible' : 'hidden';

    bossTimerTextElement.style.color = textColor;
    bossMessageTextElement.style.color = textColor;
  }

  // --- êµ°ë‹¨ ì´ë²¤íŠ¸ íƒ€ì´ë¨¸ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ ---
  function updateLegionDisplay(remainingMs) {
    const progress = Math.max(0, Math.min(1, remainingMs / LEGION_CYCLE_MS));
    const remainingMinutes = remainingMs / (60 * 1000);

    let color = COLOR_LEGION;
    let heightFactor = 0.8;
    let message = "êµ°ë‹¨ ì´ë²¤íŠ¸ ëŒ€ê¸° ì¤‘";
    let textColor = "#fff";

    if (remainingMinutes < 2) {
      color = COLOR_ALERT;
      heightFactor = 1.0;
      message = "êµ°ë‹¨ ì´ë²¤íŠ¸ ê³§ ì‹œì‘!";
      textColor = "#fff";
    } else if (remainingMinutes < 5) {
      color = COLOR_WARN;
      heightFactor = 0.9;
      message = "êµ°ë‹¨ ì´ë²¤íŠ¸ê°€ ê³§ ì‹œì‘ë©ë‹ˆë‹¤";
      textColor = "#fff";
    }

    legionProgressBarElement.style.width = `${progress * 100}%`;
    legionProgressBarElement.style.backgroundColor = color;
    legionProgressBarElement.style.height = `${heightFactor * 100}%`;
    legionProgressBarElement.style.top = `${(1 - heightFactor) / 2 * 100}%`;

    legionTimerTextElement.textContent = formatTime(remainingMs, false);
    legionMessageTextElement.textContent = message;
    legionMessageTextElement.style.visibility = message ? 'visible' : 'hidden';

    legionTimerTextElement.style.color = textColor;
    legionMessageTextElement.style.color = textColor;
  }

  // --- ë©”ì¸ ì—…ë°ì´íŠ¸ ë£¨í”„ ---
  function update() {
    const now = new Date();
    const mondayMidnight = getMostRecentMondayMidnight();
    const elapsedMsSinceMonday = now.getTime() - mondayMidnight.getTime();

    if (elapsedMsSinceMonday < 0) {
      updateBossDisplay(BOSS_CYCLE_MS);
      updateLegionDisplay(LEGION_CYCLE_MS);
      bossSoundPlayedInThisCycle = false;
      legionSoundPlayedInThisCycle = false;
      requestAnimationFrame(update);
      return;
    }

    // ì›”ë“œ ë³´ìŠ¤ íƒ€ì´ë¨¸ ê³„ì‚°
    const bossRemaining = BOSS_CYCLE_MS - (elapsedMsSinceMonday % BOSS_CYCLE_MS);
    const bossRemainingMinutes = bossRemaining / (60 * 1000);

    // êµ°ë‹¨ ì´ë²¤íŠ¸ íƒ€ì´ë¨¸ ê³„ì‚°
    const legionRemaining = LEGION_CYCLE_MS - (elapsedMsSinceMonday % LEGION_CYCLE_MS);
    const legionRemainingMinutes = legionRemaining / (60 * 1000);

    // ì›”ë“œ ë³´ìŠ¤ ì•Œë¦¼ìŒ ì¬ìƒ ë¡œì§
    if (bossRemainingMinutes < 5) {
      if (!bossSoundPlayedInThisCycle) {
        playAlertSound();
        bossSoundPlayedInThisCycle = true;
      }
    } else {
      bossSoundPlayedInThisCycle = false;
    }

    // êµ°ë‹¨ ì´ë²¤íŠ¸ ì•Œë¦¼ìŒ ì¬ìƒ ë¡œì§
    if (legionRemainingMinutes < 2) {
      if (!legionSoundPlayedInThisCycle) {
        playAlertSound();
        legionSoundPlayedInThisCycle = true;
      }
    } else {
      legionSoundPlayedInThisCycle = false;
    }

    // ë””ìŠ¤í”Œë ˆì´ ì—…ë°ì´íŠ¸
    updateBossDisplay(bossRemaining);
    updateLegionDisplay(legionRemaining);

    requestAnimationFrame(update);
  }

  // ì´ˆê¸° íƒ€ì´ë¨¸ ì‹¤í–‰
  update();

</script>

</body>
</html>
