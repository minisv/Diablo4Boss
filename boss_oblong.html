<!DOCTYPE html>
<html>
<head>
  <title>디아블로4 보스 & 군단 타이머</title>
  <meta charset="UTF-8">
  <style>
      body {
          display: flex;
          flex-direction: column;
          justify-content: center;
          align-items: center;
          min-height: 100vh;
          font-family: sans-serif;
          gap: 20px;
          padding: 20px;
      }

      /* 타이머 컨테이너 공통 스타일 */
      .timer-container {
          width: 350px;
          height: 100px;
          position: relative;
          overflow: hidden;
          border: 2px solid #333;
          border-radius: 8px;
      }

      /* 제목 스타일 */
      .timer-title {
          text-align: center;
          font-size: 1.2em;
          font-weight: bold;
          margin-bottom: 5px;
          color: #333;
      }

      /* 진행률 바 공통 스타일 */
      .progress-bar {
          position: absolute;
          left: 0;
          width: 100%;
          border-radius: 5px;
          transition: width 0.2s linear, background-color 0.3s ease, height 0.3s ease, top 0.3s ease;
      }

      /* 텍스트 오버레이 공통 스타일 */
      .text-overlay {
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          display: flex;
          flex-direction: column;
          justify-content: center;
          align-items: center;
          z-index: 1;
          pointer-events: none;
          text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);
      }

      /* 시간 텍스트 스타일 */
      .timer-text {
          font-size: 2.0em;
          font-weight: bold;
          color: #fff;
          text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);
      }

      /* 메시지 텍스트 스타일 */
      .message-text {
          font-size: 1.0em;
          font-weight: bold;
          color: #fff;
          text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.8);
          height: 1.5em;
          line-height: 1.5em;
          margin-top: 2px;
      }

      /* 오디오 재생 실패 시 사용자 안내 메시지 스타일 */
      #audio-prompt {
          position: fixed;
          top: 10px;
          left: 50%;
          transform: translateX(-50%);
          background-color: rgba(255, 255, 0, 0.8);
          padding: 10px;
          border: 1px solid black;
          border-radius: 5px;
          z-index: 1000;
          cursor: pointer;
          font-size: 0.9em;
      }
  </style>
</head>
<body>

<!-- 월드 보스 타이머 -->
<div>
  <div class="timer-container" id="boss-timer-container">
    <div class="progress-bar" id="boss-progress-bar"></div>
    <div class="text-overlay">
      <div class="timer-text" id="boss-timer-text">--:--:--</div>
      <div class="message-text" id="boss-message-text"></div>
    </div>
  </div>
</div>

<!-- 군단 이벤트 타이머 -->
<div>
  <div class="timer-container" id="legion-timer-container">
    <div class="progress-bar" id="legion-progress-bar"></div>
    <div class="text-overlay">
      <div class="timer-text" id="legion-timer-text">--:--</div>
      <div class="message-text" id="legion-message-text"></div>
    </div>
  </div>
</div>

<audio id="alert-sound" src="impact.mp3" preload="auto"></audio>

<div id="audio-prompt" style="display: none;">알림 소리를 재생하려면 여기를 클릭하세요.</div>

<script>
  // --- DOM 요소 가져오기 ---
  // 월드 보스 타이머 요소들
  const bossProgressBarElement = document.getElementById('boss-progress-bar');
  const bossTimerTextElement = document.getElementById('boss-timer-text');
  const bossMessageTextElement = document.getElementById('boss-message-text');

  // 군단 이벤트 타이머 요소들
  const legionProgressBarElement = document.getElementById('legion-progress-bar');
  const legionTimerTextElement = document.getElementById('legion-timer-text');
  const legionMessageTextElement = document.getElementById('legion-message-text');

  // 공통 요소들
  const alertSound = document.getElementById('alert-sound');
  const audioPromptElement = document.getElementById('audio-prompt');

  // --- 상수 설정 ---
  // 월드 보스: 3시간 30분
  const BOSS_CYCLE_MINUTES = 3 * 60 + 30;
  const BOSS_CYCLE_MS = BOSS_CYCLE_MINUTES * 60 * 1000;

  // 군단 이벤트: 25분
  const LEGION_CYCLE_MINUTES = 25;
  const LEGION_CYCLE_MS = LEGION_CYCLE_MINUTES * 60 * 1000;

  const COLOR_DEFAULT = '#0092FF';
  const COLOR_WARN = 'orange';
  const COLOR_ALERT = 'red';
  const COLOR_LEGION = '#9d4edd'; // 군단 이벤트 기본 색상 (보라색)

  // --- 상태 변수 ---
  let bossSoundPlayedInThisCycle = false;
  let legionSoundPlayedInThisCycle = false;

  // --- 함수 정의 ---
  function getMostRecentMondayMidnight() {
    const now = new Date();
    const currentDay = now.getDay();
    const daysSinceMonday = (currentDay === 0) ? 6 : currentDay - 1;
    const mondayMidnight = new Date(now);
    mondayMidnight.setDate(now.getDate() - daysSinceMonday);
    mondayMidnight.setHours(0, 0, 0, 0);
    return mondayMidnight;
  }

  function formatTime(ms, showSeconds = true) {
    if (ms < 0) ms = 0;
    const totalSeconds = Math.floor(ms / 1000);
    const hours = Math.floor(totalSeconds / 3600);
    const minutes = Math.floor((totalSeconds % 3600) / 60);
    const seconds = totalSeconds % 60;

    if (showSeconds) {
      return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
    } else {
      return `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
    }
  }

  function playAlertSound() {
    alertSound.currentTime = 0;
    const playPromise = alertSound.play();
    if (playPromise !== undefined) {
      playPromise.then(_ => {
        audioPromptElement.style.display = 'none';
        console.log("알림음 자동 재생 성공");
      }).catch(error => {
        console.error("알림음 자동 재생 실패:", error);
        if (audioPromptElement.style.display === 'none') {
          audioPromptElement.style.display = 'block';
          audioPromptElement.onclick = () => {
            alertSound.play();
            audioPromptElement.style.display = 'none';
            audioPromptElement.onclick = null;
          };
        }
      });
    }
  }

  // --- 월드 보스 타이머 업데이트 함수 ---
  function updateBossDisplay(remainingMs) {
    const progress = Math.max(0, Math.min(1, remainingMs / BOSS_CYCLE_MS));
    const remainingMinutes = remainingMs / (60 * 1000);

    let color = COLOR_DEFAULT;
    let heightFactor = 0.8;
    let message = "디아블로4 월드 보스 알림이";
    let textColor = "#fff";

    if (remainingMinutes < 5) {
      color = COLOR_ALERT;
      heightFactor = 1.0;
      message = "빨리 뛰어 월드 보스 잡아야 해";
      textColor = "#fff";
    } else if (remainingMinutes < 10) {
      color = COLOR_WARN;
      heightFactor = 0.8;
      message = "월드 보스가 곧 등장합니다";
      textColor = "#fff";
    } else if (remainingMinutes > 10) {
      color = COLOR_DEFAULT;
      heightFactor = 0.8;
      message = "디아블로4 월드 보스 알림이";
      textColor = "#fff";
    }

    bossProgressBarElement.style.width = `${progress * 100}%`;
    bossProgressBarElement.style.backgroundColor = color;
    bossProgressBarElement.style.height = `${heightFactor * 100}%`;
    bossProgressBarElement.style.top = `${(1 - heightFactor) / 2 * 100}%`;

    bossTimerTextElement.textContent = formatTime(remainingMs, true);
    bossMessageTextElement.textContent = message;
    bossMessageTextElement.style.visibility = message ? 'visible' : 'hidden';

    bossTimerTextElement.style.color = textColor;
    bossMessageTextElement.style.color = textColor;
  }

  // --- 군단 이벤트 타이머 업데이트 함수 ---
  function updateLegionDisplay(remainingMs) {
    const progress = Math.max(0, Math.min(1, remainingMs / LEGION_CYCLE_MS));
    const remainingMinutes = remainingMs / (60 * 1000);

    let color = COLOR_LEGION;
    let heightFactor = 0.8;
    let message = "군단 이벤트 대기 중";
    let textColor = "#fff";

    if (remainingMinutes < 2) {
      color = COLOR_ALERT;
      heightFactor = 1.0;
      message = "군단 이벤트 곧 시작!";
      textColor = "#fff";
    } else if (remainingMinutes < 5) {
      color = COLOR_WARN;
      heightFactor = 0.9;
      message = "군단 이벤트가 곧 시작됩니다";
      textColor = "#fff";
    }

    legionProgressBarElement.style.width = `${progress * 100}%`;
    legionProgressBarElement.style.backgroundColor = color;
    legionProgressBarElement.style.height = `${heightFactor * 100}%`;
    legionProgressBarElement.style.top = `${(1 - heightFactor) / 2 * 100}%`;

    legionTimerTextElement.textContent = formatTime(remainingMs, false);
    legionMessageTextElement.textContent = message;
    legionMessageTextElement.style.visibility = message ? 'visible' : 'hidden';

    legionTimerTextElement.style.color = textColor;
    legionMessageTextElement.style.color = textColor;
  }

  // --- 메인 업데이트 루프 ---
  function update() {
    const now = new Date();
    const mondayMidnight = getMostRecentMondayMidnight();
    const elapsedMsSinceMonday = now.getTime() - mondayMidnight.getTime();

    if (elapsedMsSinceMonday < 0) {
      updateBossDisplay(BOSS_CYCLE_MS);
      updateLegionDisplay(LEGION_CYCLE_MS);
      bossSoundPlayedInThisCycle = false;
      legionSoundPlayedInThisCycle = false;
      requestAnimationFrame(update);
      return;
    }

    // 월드 보스 타이머 계산
    const bossRemaining = BOSS_CYCLE_MS - (elapsedMsSinceMonday % BOSS_CYCLE_MS);
    const bossRemainingMinutes = bossRemaining / (60 * 1000);

    // 군단 이벤트 타이머 계산
    const legionRemaining = LEGION_CYCLE_MS - (elapsedMsSinceMonday % LEGION_CYCLE_MS);
    const legionRemainingMinutes = legionRemaining / (60 * 1000);

    // 월드 보스 알림음 재생 로직
    if (bossRemainingMinutes < 5) {
      if (!bossSoundPlayedInThisCycle) {
        playAlertSound();
        bossSoundPlayedInThisCycle = true;
      }
    } else {
      bossSoundPlayedInThisCycle = false;
    }

    // 군단 이벤트 알림음 재생 로직
    if (legionRemainingMinutes < 2) {
      if (!legionSoundPlayedInThisCycle) {
        playAlertSound();
        legionSoundPlayedInThisCycle = true;
      }
    } else {
      legionSoundPlayedInThisCycle = false;
    }

    // 디스플레이 업데이트
    updateBossDisplay(bossRemaining);
    updateLegionDisplay(legionRemaining);

    requestAnimationFrame(update);
  }

  // 초기 타이머 실행
  update();

</script>

</body>
</html>
